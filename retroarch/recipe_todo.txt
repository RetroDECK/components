Migrate to the Flatpak version.
Check what cores, cheats etc are included and migrate the script:

#!/bin/bash

source "automation-tools/assembler.sh"

artifacts_dir="$component/artifacts"

# Stable Cores
# Doing this here so the version will be calculated later
assemble generic "https://buildbot.libretro.com/stable/*/linux/x86_64/RetroArch_cores.7z"

assemble appimage "https://buildbot.libretro.com/stable/*/linux/x86_64/RetroArch.7z"

# Custom Commands
extras="$artifacts_dir/rd_extras"
mkdir -p "$extras"

# Unfortunately this is a one off as we need to extract even the assets from the same appimage
rm -rf "$WORK_DIR/squashfs-root"

wget "$url" -O "$WORK_DIR/RetroArch.7z"
7z x "$WORK_DIR/RetroArch.7z" -o"$WORK_DIR"
rm -rf "$WORK_DIR/RetroArch.7z"
"$WORK_DIR/RetroArch-Linux-x86_64/RetroArch-Linux-x86_64.AppImage" --appimage-extract -o "$WORK_DIR/squashfs-root"

cp -rf "$WORK_DIR/RetroArch-Linux-x86_64/RetroArch-Linux-x86_64.AppImage.home/.config/retroarch/"* "$WORK_DIR/"
rm -rf "$WORK_DIR/RetroArch-Linux-x86_64"

# Stable Cores - PT 2
mv "$artifacts_dir/RetroArch-Linux-x86_64/RetroArch-Linux-x86_64.AppImage.home/.config/retroarch/cores/"* "$WORK_DIR/cores/"
rm -rf "$artifacts_dir/RetroArch-Linux-x86_64"

# Citra Libretro Core
# Citra is removed from the LibretroCores but is still available in Libretro 
log i "Downloading Citra Libretro core..." "$logfile"
wget "https://buildbot.libretro.com/nightly/linux/x86_64/latest/citra_libretro.so.zip" -O "$WORK_DIR/citra_libretro.so.zip"
unzip -o "$WORK_DIR/citra_libretro.so.zip" -d "$WORK_DIR/cores/"
rm -rf "$WORK_DIR/citra_libretro.so.zip"

# Sameduck Libretro Core
# Sameduck is removed from the LibretroCores but is still available in Libretro
log i "Downloading Sameduck Libretro core..." "$logfile"
wget "https://buildbot.libretro.com/nightly/linux/x86_64/latest/sameduck_libretro.so.zip" -O "$WORK_DIR/sameduck_libretro.so.zip"
unzip -o "$WORK_DIR/sameduck_libretro.so.zip" -d "$WORK_DIR/cores/"
rm -rf "$WORK_DIR/sameduck_libretro.so.zip"

# Genesis Plus GX [Expanded Rom Size] (Paprium) Libretro Core
# This core is needed for Paprium and is not available in the main Libretro Cores
log i "Downloading Genesis Plus GX [Expanded Rom Size] (Paprium) Libretro Core..." "$logfile"
wget "https://github.com/RapidEdwin08/Genesis-Plus-GX-Expanded-Rom-Size/raw/refs/heads/master/builds/Linux_so64/genesis_plus_gx_libretro.so" -O "$WORK_DIR/cores/genesis-plus-gx-expanded-rom-size-paprium_libretro.so"

# Nightly Cores
# As some comres are not available in the stable version, we need to download the nightly cores
# must be earlier than retroarch-cores as it will overwrite this cores with the stable ones
log i "Downloading RetroArch nightly cores..." "$logfile"
wget "https://buildbot.libretro.com/nightly/linux/x86_64/RetroArch_cores.7z" -O "$WORK_DIR/RetroArch_cores_nightly.7z"
7z x "$WORK_DIR/RetroArch_cores_nightly.7z" -o"$WORK_DIR/cores_nightly"
rm -rf "$WORK_DIR/RetroArch_cores_nightly.7z"
# Without overwriting the existent cores
log d "Copying RetroArch nightly cores that are not available in the main build..." "$logfile"
cp -vrn "$WORK_DIR/cores_nightly/RetroArch-Linux-x86_64/RetroArch-Linux-x86_64.AppImage.home/.config/retroarch/cores/"* "$WORK_DIR/cores/"
rm -rf "$WORK_DIR/cores_nightly"

# RetroArch Cheats
log i "Downloading RetroArch cheats..." "$logfile"
git clone --depth 1 "https://github.com/libretro/libretro-database.git" "$WORK_DIR/libretro-database"
tar -vczf "$extras/cheats.tar.gz" -C "$WORK_DIR/libretro-database/cht" .
rm -rf "$WORK_DIR/libretro-database"

# MSX BIOS
log i "Downloading MSX BIOS..." "$logfile"
wget "http://bluemsx.msxblue.com/rel_download/blueMSXv282full.zip" -O "$WORK_DIR/bluemsx.zip"
unzip -o "$WORK_DIR/bluemsx.zip" -d "$WORK_DIR/bluemsx"
rm -rf "$WORK_DIR/bluemsx.zip"
mkdir -p "$artifacts_dir/$extras/MSX"
cp -rf "$WORK_DIR/bluemsx/Machines" "$artifacts_dir/$extras/MSX/"
cp -rf "$WORK_DIR/bluemsx/Databases" "$artifacts_dir/$extras/MSX/"
rm -rf "$WORK_DIR/bluemsx"

# Amiga BIOS
log i "Downloading Amiga BIOS..." "$logfile"
wget "https://github.com/rsn8887/capsimg/releases/download/1.1/Capsimg_for_Retroarch.zip" -O "$WORK_DIR/capsimg.zip"
unzip -o "$WORK_DIR/capsimg.zip" -d "$WORK_DIR/capsimg"
rm -rf "$WORK_DIR/capsimg.zip"
mkdir -p "$artifacts_dir/$extras/Amiga"
cp -r "$WORK_DIR/capsimg/Linux/x86-64/capsimg.so" "$artifacts_dir/$extras/Amiga/capsimg.so"
rm -rf "$WORK_DIR/capsimg"

# These folders are not used from /app/components/retrodeck/retroarch
# as RetroArch wants them to be placed in a rw filesystem (so userland)
# else retroarch will not work properly or users cannot add their shaders and borders

tar -czf "$artifacts_dir/$extras/shaders.tar.gz" -C "$WORK_DIR" "shaders"
rm -rf "$WORK_DIR/shaders"
tar -czf "$artifacts_dir/$extras/cores.tar.gz" -C "$WORK_DIR" "cores"
rm -rf "$WORK_DIR/cores"
tar -czf "$artifacts_dir/$extras/overlays.tar.gz" -C "$WORK_DIR" "overlays"
rm -rf "$WORK_DIR/overlays"

cp -rf "$WORK_DIR/"* "$artifacts_dir/"

finalize


----


we need a step to compress the cores so the preparation can find them and extract them
